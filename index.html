
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>üöÄ ÌïòÏù¥ÌçºÎùºÏö¥ÏßÄ ÎßõÏßëÏ†ïÎ≥¥ üöÄ</title>
  <link rel="stylesheet" href="./css/reset.css">
	<script src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
	<div id="map" style="width:100%;height:100%;"></div>
	<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=01aa44b3340aad376f86b7901337986e&libraries=services"></script>
	<script>
		let markers = [];
		document.addEventListener('DOMContentLoaded', () => {

			google.charts.load('current', { packages: ['corechart'] }).then(function () {
				const query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1cuKz1qjs6wosA2H4EwT1LpKGa4FdLLocYAyQt2QkBjs/edit#gid=0');
				query.send(function (response) {
					let dataTable = response.getDataTable();
					let jsonData = dataTable.toJSON();
					jsonData = JSON.parse(jsonData);
					console.log(jsonData)
					const a = jsonData.rows.filter((source) => source.c[3] != null)
					a.map(source => {
						let c = (source.c[5] !== null) ? source.c[5].v + ' ' + source.c[3].v : source.c[3].v;
						searchPlaces(c)
					})
				});
			});
		})


		const container = document.getElementById('map');
		const options = {
			center: new kakao.maps.LatLng(37.541, 126.986),
			level: 8
		};

		let map = new kakao.maps.Map(container, options);

		let geocoder = new kakao.maps.services.Geocoder();
		let ps = new kakao.maps.services.Places();
		let infowindow = new kakao.maps.InfoWindow({zIndex:1});

		function searchPlaces(keyword) {
			ps.keywordSearch(keyword, placesSearchCB); 
		}

		function placesSearchCB(data, status, pagination) {
			if (status === kakao.maps.services.Status.OK) {
				displayPlaces(data);
			}
		}
		function displayPlaces(places) {
			let fragment = document.createDocumentFragment(), 
			bounds = new kakao.maps.LatLngBounds(), 
			listStr = '';

			for ( let i=0; i<places.length; i++ ) {
				// ÎßàÏª§Î•º ÏÉùÏÑ±ÌïòÍ≥† ÏßÄÎèÑÏóê ÌëúÏãúÌï©ÎãàÎã§
				let placePosition = new kakao.maps.LatLng(places[i].y, places[i].x),
				marker = addMarker(placePosition, i), 
				itemEl = getListItem(i, places[i]); // Í≤ÄÏÉâ Í≤∞Í≥º Ìï≠Î™© ElementÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§

				// Í≤ÄÏÉâÎêú Ïû•ÏÜå ÏúÑÏπòÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÏßÄÎèÑ Î≤îÏúÑÎ•º Ïû¨ÏÑ§Ï†ïÌïòÍ∏∞ÏúÑÌï¥
				// LatLngBounds Í∞ùÏ≤¥Ïóê Ï¢åÌëúÎ•º Ï∂îÍ∞ÄÌï©ÎãàÎã§
				bounds.extend(placePosition);

				// ÎßàÏª§ÏôÄ Í≤ÄÏÉâÍ≤∞Í≥º Ìï≠Î™©Ïóê mouseover ÌñàÏùÑÎïå
				// Ìï¥Îãπ Ïû•ÏÜåÏóê Ïù∏Ìè¨ÏúàÎèÑÏö∞Ïóê Ïû•ÏÜåÎ™ÖÏùÑ ÌëúÏãúÌï©ÎãàÎã§
				// mouseout ÌñàÏùÑ ÎïåÎäî Ïù∏Ìè¨ÏúàÎèÑÏö∞Î•º Îã´ÏäµÎãàÎã§
				(function(marker, title) {
					kakao.maps.event.addListener(marker, 'mouseover', function() {
						displayInfowindow(marker, title);
					});

					kakao.maps.event.addListener(marker, 'mouseout', function() {
						infowindow.close();
					});

					itemEl.onmouseover =  function () {
						displayInfowindow(marker, title);
					};

					itemEl.onmouseout =  function () {
						infowindow.close();
					};
				})(marker, places[i].place_name);

				fragment.appendChild(itemEl);
			}
		}
		function displayInfowindow(marker, title) {
			let content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

			infowindow.setContent(content);
			infowindow.open(map, marker);
		}
		function getListItem(index, places) {
			var el = document.createElement('li'),
			itemStr = '<span class="markerbg"></span>' +
			'<div class="info">' + '<h5>' + places.place_name + '</h5>';

			if (places.road_address_name) {
				itemStr += '<span>' + places.road_address_name + '</span>' + '<span class="jibun gray">' +  places.address_name  + '</span>';
			} else {
				itemStr += '<span>' +  places.address_name  + '</span>'; 
			}

			itemStr += '<span class="tel">' + places.phone  + '</span>' + '</div>';

			el.innerHTML = itemStr;
			el.className = 'item';

			return el;
		}
		function removeMarker() {
			for ( var i = 0; i < markers.length; i++ ) {
				markers[i].setMap(null);
			}   
			markers = [];
		}
		function addMarker(position, idx, title) {
			marker = new kakao.maps.Marker({
				position: position, // ÎßàÏª§Ïùò ÏúÑÏπò
			});

			marker.setMap(map); // ÏßÄÎèÑ ÏúÑÏóê ÎßàÏª§Î•º ÌëúÏ∂úÌï©ÎãàÎã§
			markers.push(marker);  // Î∞∞Ïó¥Ïóê ÏÉùÏÑ±Îêú ÎßàÏª§Î•º Ï∂îÍ∞ÄÌï©ÎãàÎã§

			return marker;
		}
	</script>
</body>
</html>